# 网页授权机制

本文只分享项目实战开发中踩过的坑，以及实际的解决方案（非第三方开发解决方案）  
[请参考微信公众平台开发者文档](https://mp.weixin.qq.com/wiki/4/9ac2e7b1f1d22e9e57260f6553822520.html)

> 第一步 了解openid和unionid

1. openid可以唯一标识用户，每个用户针对每个公众号会产生一个安全的openid
2. unionid可以在多个公众号、移动应用做用户共通

> 第二步 了解授权机制

1. 需要在公众平台配置授权回调域名
2. 两种授权类型：静默授权获取用户openid、授权登录获取用户基本信息（实质都是跳转到授权链接进行授权然后又跳转回配置的回调页面链接，此时回调页面链接会带上code字段，然后进行下一步业务获取openid或者用户基本信息）
3. 静默授权机制：当跳转到静默授权链接进行授权后自动跳转回调页面，该行为用户无明显感知，只看到加载进度条发生了两次加载
4. 授权登录机制：当跳转到授权登录链接时需要用户决定是否同意登录，该行为如果发生在用户从公众号的会话或者菜单进入授权，则行为和静默授权一样
5. 注意事项：
   - 授权登录获取用户基本信息，和用户管理类接口中的“获取用户基本信息接口”不一样，后者是用户必须关注了公众号才会调用成功拿到数据
   - 通过code换取的access_token，和基础支持获取的access_token不一样，后者用于调用JSSDK接口与公众号开发

> 第三步 了解授权后如何通过code字段进行下一步业务

1. 静默授权：通过code获取openid
2. 授权登录：通过code获取openid和access_token，从而获取用户基本信息
3. 以上业务需要在服务器端执行

> 第四步 项目实战（附上代码）  
> *后台需要做的配合：配合静默授权提供一个用户查重接口、配合授权登录提供一个新增用户接口*

1. 在前端处理用户登录的公共javascript脚本
```javascript

```
2. 在服务器端执行获取openid或者用户基本信息的php脚本